- file:
    path: "~/logs"
    state: directory
  become: true
  become_method: sudo
  become_user: "ansible"

- name: install cron job (ansible-pull)
  cron: user="ansible" name="ansible provision" minute="*/10" job="/usr/bin/ansible-pull --accept-host-key --private-key=$HOME/.ssh/id_rsa -o -U git@gitlab.com:szydell/laptak.git > $HOME/logs/ansible-$(date -I'minutes').log"

- name: install cron job (clean logs)
  cron: user="ansible" name="clear ansible logs" hour="*/1" job="/usr/bin/find $HOME/logs/ansible* -mtime +6 -type f -delete"

- name: install cron job (clean empty logs)
  cron: user="ansible" name="clear empty logs" hour="*/1" job="/usr/bin/find $HOME/logs/ansible* -type f -size -1024c -mmin +179 -delete"
